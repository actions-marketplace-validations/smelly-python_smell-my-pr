name: 'Smelly Python: Smell My PR'
description: 'TODO'
branding:
  icon: 'message-square'
  color: 'orange'
inputs:
  python-dir: 
    description: The folder containing python files for pylint.
    required: true
    default: src
runs:
  using: "composite"
  steps:
    # Generate report
    - name: Generate report from smelly-python
      run: smelly-python -f ${{ inputs.python-dir }}
    - run: mv ${{ github.workspace }}/report/comment.md ${{ github.workspace }}/report/comment-$(date -d "today" +"%Y%m%d%H%M").md 
    - name: Save .md report
      uses: actions/upload-artifact@v3
      with: 
        name: smelly-python-${{ github.action }}.md
        path: ${{ github.workspace }}
    - name: Save output folder with html files
      uses: actions/upload-artifact@v3
      with:
        name: smelly-python-${{ github.action }}.md
        path: ${{ github.workspace }}/report/comment-*.md
    - name: Download report 
      uses: actions/download-artifact@v3
      with:
        name: smelly-python-${{ github.action }}.md
    - name: Post comment
      uses: danielhs1/comment-on-pr@v1.3.2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with: 
        msg: smelly-python-${{ github.action }}.md
